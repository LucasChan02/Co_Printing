[include mainsail.cfg]
[mcu]
serial: /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0

[virtual_sdcard]
path: ~/printer_data/gcodes 
# Directory where Klipper/Moonraker can store/manage G-code files if needed.
# For robotic printing, G-code might be streamed directly via API calls from ROS.
on_error_gcode: CANCEL_PRINT # Example: run CANCEL_PRINT macro on error.


rename_existing: BASE_CANCEL_PRINT 
# Allows Klipper's internal CANCEL_PRINT to still be called if needed.
description: Cancels the current print, turns off heaters and fan.
gcode:
    TURN_OFF_HEATERS
    M107 ; Turn off part cooling fan (if [fan] is configured)
    CLEAR_PAUSE
    SDCARD_RESET_FILE ; If using virtual_sdcard
    BASE_CANCEL_PRINT ; Call Klipper's original cancel actions
    M117 Print Cancelled
[printer]
kinematics: none
max_velocity: 10
max_accel: 50

[extruder]
# E0 Stepper Motor Pins (from generic-ramps.cfg for ATmega2560)
step_pin: PA4      # Corresponds to E0_STEP on RAMPS
dir_pin:!PA6      # Corresponds to E0_DIR on RAMPS. Add '!' to invert if needed.
enable_pin:!PA2   # Corresponds to E0_ENABLE on RAMPS. Add '!' to invert if needed.

microsteps: 16     # Common for A4988/DRV8825 drivers on RAMPS.
rotation_distance: 31.68
# This is CRITICAL. It's the mm of filament extruded per full stepper motor rotation.
# Example starting points: 33.500 (from generic-ramps.cfg [18]) or 7.711 (from another example [19]).
# MUST BE CALIBRATED for your specific extruder, gear ratio, and hobbed gear.
# Klipper docs explain calibration: measure filament, adjust, repeat.

nozzle_diameter: 0.400
filament_diameter: 1.750

# Hotend Heater Pin (D10 on RAMPS = PB4 on ATmega2560)
heater_pin: PB4 
# Hotend Thermistor Pin (T0 on RAMPS, analog pin A13 = PK5 on ATmega2560)
sensor_pin: PK5 
sensor_type: EPCOS 100K B57560G104F 
# This is a common thermistor type. Verify for your specific hotend.
# Other types include: Generic 3950, ATC Semitec 104GT-2, etc.
# See Klipper documentation for a list of supported sensor_types.[20]

control: pid             # Use PID algorithm for temperature control.
#!!! THESE PID VALUES MUST BE CALIBRATED using Klipper's PID_CALIBRATE command!!!
# Example: PID_CALIBRATE HEATER=extruder TARGET=210
pid_Kp: 22.2             # Starting Kp value (from generic-ramps.cfg [18]).
pid_Ki: 1.08             # Starting Ki value.
pid_Kd: 114              # Starting Kd value.

min_temp: 0              # Minimum temperature Klipper will allow.
max_temp: 240            # Maximum safe operating temperature
min_extrude_temp: 190    # Safety feature: Klipper will not extrude if temperature is below this.

# Optional but Recommended: Pressure Advance for improved print quality.[1, 3]
# pressure_advance: 0.0  # Start with 0.0 and calibrate using Klipper's tuning guide.
# pressure_advance_smooth_time: 0.040 # Default, usually okay.

# Retraction settings can be controlled by G-code from ROS (e.g., G10/G11 if supported by Klipper setup,
# or by sending explicit G1 E- moves). Klipper can also manage retraction if configured here
# and invoked by G20/G21 (requires [firmware_retraction] section).
# For robotic printing, ROS might handle retraction logic by sending specific G1 E commands.

[fan]
# Part Cooling Fan Pin (D9 on RAMPS = PH6 on ATmega2560)
pin: PH6

